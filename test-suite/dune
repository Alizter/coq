(rule
 (alias test-gen)
 (targets test_suite_rules.sexp)
 (deps
  (source_tree bugs)
  ; (source_tree complexity)
  ; (source_tree coq-makefile)
  ; (source_tree coqchk)
  ; (source_tree coqdoc)
  ; (source_tree coqwc)
  ; (source_tree failure)
  ; (source_tree ide)
  ; (source_tree interactive)
  ; (source_tree ltac2)
  (source_tree micromega)
  (source_tree misc)
  ; (source_tree modules)
  (source_tree output)
  ; (source_tree output-coqchk)
  ; (source_tree output-coqtop)
  ; (source_tree output-modulo-time)
  (source_tree prerequisite)
  ; (source_tree primitive)
  (source_tree ssr)
  (source_tree stm)
  (source_tree success)
  ; (source_tree unit-tests)
  ; (source_tree vio)

  ; coqdep needs this to run
  %{bin:coqdep}
  (source_tree ../theories)
  (source_tree ../user-contrib)

  %{bin:coqtacticworker.opt}
  %{bin:coqqueryworker.opt}
  %{bin:coqproofworker.opt}

  micromega/.csdp.cache
  %{bin:csdpcert})
 (mode promote)
 (action (run ./tools/gen_rules/gen_rules.exe)))

(include test_suite_rules.sexp)

(subdir output
 (rule
   (targets MExtraction.out)
   (action (copy ../../plugins/micromega/micromega.ml %{targets}))))
