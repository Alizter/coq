(rule
 (targets .csdp.cache)
 (deps .csdp.cache.test-suite)
 (action (copy %{deps} %{targets})))

(rule
 (targets test_suite_rules.sexp)
 (deps
  (source_tree prerequisite)
  (source_tree success)
  (source_tree failure)
  (source_tree bugs)
  (source_tree modules)
  (source_tree micromega)

  ; coqdep needs this to run
  %{bin:coqdep}
  (source_tree ../theories)
  (source_tree ../user-contrib)

  %{bin:coqtacticworker.opt}
  %{bin:coqqueryworker.opt}
  %{bin:coqproofworker.opt}

  .csdp.cache
  %{bin:csdpcert})
 (mode promote)
 (action (run ./tools/gen_rules/gen_rules.exe)))

(include test_suite_rules.sexp)
